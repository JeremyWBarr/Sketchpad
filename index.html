<!DOCTYPE html>
<html>
<head>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<title> Sketchpad: Login </title>
<script>
function getCookie(name) {
	var re = new RegExp(name + "=([^;]+)");
	var value = re.exec(document.cookie);
	return (value != null) ? unescape(value[1]) : null;
}

function login() {
	var re = new RegExp("userLoggedIn=([^;]+)");
	var value = re.exec(document.cookie);
	if(value != null) {
		document.location.href = 'main/main.html';
	}
}

const API = 'sketchpad.php';

jQuery(document).ready(function(){
    jQuery('form').on('submit', function(e){
        var jqElm = jQuery(this);
        jqElm.parents('.section').find('div').html('');

        console.log(removeEmptyParams(jqElm.serialize()));
        var post = jQuery.post(API, removeEmptyParams(jqElm.serialize()), function(d){
            console.log(typeof d);
            if(typeof d === "object"){
                jqElm.parents('.section').find('div').html(
                    JSON.stringify(d, undefined, 2)).addClass('pre');
            } else {
                try{
                    jqElm.parents('.section').find('div').html(
                        JSON.stringify(JSON.parse(d), undefined, 2)).addClass('pre');
                } catch(e) {
                    jqElm.parents('.section').find('div').html(d).removeClass('pre');
                }
            }
        });

        post.fail(function(elm, status, error){
            jqElm.parents('.section').find('div').html(error).removeClass('pre');
        });

        e.preventDefault();
    });
});

function removeEmptyParams(string){
    return string.replace(/&{0,1}\w+=(&|$)/g, "$1");
}
</script>

<style type="text/css">
	
	@font-face{
		font-family: CrayonFont;
		src: url('fonts/crayon.ttf') format('truetype');
	}

	h1 {
		text-align: center;
		font-family: CrayonFont;
		font-size: 1000%;
	}

	.login {
		text-align: center;	
		font-family: CrayonFont;
		font-size: 100%;
	}

	input {
		width: 20%;
		height: 50px;
	}

	.server-response {
	    width: 400px;
	    height: 200px;
	    border: 1px solid gray;
	    overflow: auto;
	    padding: 5px;
	}

</style>
</head>
<body onload="login()">
	<h1> SKETCHPAD </h1>
	<div class="section">
		<form>
			<input type="hidden" name="action" value="signin"/>
		  	Username: <input type="text" name="uname"/><br/>
		  	Password: <input type="text" name="pass"/><br/>
		  	<input type="submit" value="Login"/>
		  	<input type="submit" value="Create Account" onclick="window.location.href='other/createAccount.html'" />
	  	</form>
	  	Server Response:<br/>
	    <div class="server-response"></div>
	</div>
</body>
</html>
